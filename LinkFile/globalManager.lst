C51 COMPILER V9.59.0.0   GLOBALMANAGER                                                     04/24/2019 17:00:43 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE GLOBALMANAGER
OBJECT MODULE PLACED IN .\bin\globalManager.obj
COMPILER INVOKED BY: G:\Keil_v5\C51\BIN\C51.EXE globalManager\globalManager.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEN
                    -D PRINT(.\LinkFile\globalManager.lst) TABS(2) OBJECT(.\bin\globalManager.obj)

line level    source

   1          #include "globalManager.h"
   2          //全局管理全局对象
   3          static  GlobalManager this;
   4          /**
   5           * @brief 上电的时候初始化整个单片机所有的参数函数
   6           */
   7          void g_initSystemParameter()
   8          {
   9   1          //定时器中断初始化
  10   1          interrupt1Init();
  11   1          //初始化串口
  12   1          uartInit();
  13   1          //函数的初始化
  14   1          this.controlMotor1StatusFunc=controlMotor1Status;
  15   1          this.controlMotor2StatusFunc=controlMotor2Status;
  16   1          this.handleSensorDataFunc=handleSensorData; 
  17   1          this.handleSendSmsInfoFunc=handleSendSmsInfo; 
  18   1      }
  19          const GlobalManager g_getGlobalManagerObj()
  20          {
  21   1        return this;
  22   1      }
  23          static const bool controlMotor1Status(const MotorStatus status)
  24          {
  25   1          switch(status){
  26   2            case Move_Up:               //正转
  27   2              Motor1ControlTurn(true,MOTOR1CIRCLENUMBER);
  28   2                    //todo把记录写入EEPROM
  29   2              return true;
  30   2            case Move_Down:              //反转
  31   2              Motor1ControlTurn(false,MOTOR1CIRCLENUMBER);
  32   2                    //todo把记录写入EEPROM
  33   2              return true;
  34   2            case Move_Stop:             //停止
  35   2              Motor1ControlStop();
  36   2              return true;
  37   2            default:
  38   2              return false;
  39   2          } 
  40   1      }
  41          static const bool controlMotor2Status(const MotorStatus status)
  42          {
  43   1          switch(status){
  44   2            case Move_Up:               //正转
  45   2              Motor2ControlTurn(true,MOTOR2CIRCLENUMBER);
  46   2              return true;
  47   2            case Move_Down:              //反转
  48   2              Motor2ControlTurn(false,MOTOR2CIRCLENUMBER);
  49   2              return true;
  50   2            case Move_Stop:             //停止
  51   2              Motor2ControlStop();
  52   2              return true;
  53   2            default:
  54   2              return false;
C51 COMPILER V9.59.0.0   GLOBALMANAGER                                                     04/24/2019 17:00:43 PAGE 2   

  55   2          } 
  56   1      }
  57          const bool handleSensorData(void)
  58          {
  59   1          uint8_t *adcValuePtr=nullptr;
  60   1          adcValuePtr=getAdcValue(0);//获取adc通道1的真实转换值，也就是in0对应的传感器的值
  61   1          //todo 处理传感器的值与阈值判断 
  62   1        
  63   1        
  64   1            return false;
  65   1      }
  66          static const bool handleSendSmsInfo(void)
  67          {
  68   1        //todo发送gsm的信息
  69   1        sendThresholdToPhone("test");
  70   1        return true;
  71   1      }
  72          void g_delay(const uint32_t one_10us)
  73          {
  74   1        if(!one_10us)
  75   1          return;
  76   1        g_EndCount=one_10us;
  77   1        g_CurrentCount=0;
  78   1        forever{
  79   2          if(g_CurrentCount>=g_EndCount)
  80   2            break;
  81   2        }
  82   1      }
  83          static void  interrupt1Init()
  84          {
  85   1        EA = OPEN;
  86   1        TMOD = 0x11;
  87   1        ET0 = OPEN;
  88   1        //10 us
  89   1        TH0=(65536-10)/256;
  90   1        TL0=(65536-10)%256;
  91   1        TR0=OPEN;
  92   1      }
  93          static void  uartInit()
  94          {
  95   1        //设置9600的波特率
  96   1      #ifdef RATE12
  97   1          RCAP2L=0xD9;
  98   1          RCAP2H=0xFF;
  99   1          T2CON=0x34;
 100   1          SCON=0x50;
 101   1          ES=OPEN;
 102   1          EA=OPEN;
 103   1      #else
                  PCON &= 0x7F;
                  SCON = 0x50;
                  TMOD &= 0x0F; 
                  TMOD |= 0x20;
                  TL1 = 0xFD;
                  TH1 = 0xFD;
                  ET1 = 0;
                  TR1 = OPEN; 
                  ES  = OPEN;
              #endif
 114   1      }
 115          /*******************************************************************************
 116          * 函 数 名         : timeout
C51 COMPILER V9.59.0.0   GLOBALMANAGER                                                     04/24/2019 17:00:43 PAGE 3   

 117          * 函数功能       :定时器中断触发
 118          * 输    入         : 无
 119          * 输    出         : 无
 120          *******************************************************************************/
 121          void timeout(void) interrupt 1
 122          {
 123   1        //10 us
 124   1        TH0=(65536-10)/256;
 125   1        TL0=(65536-10)%256;
 126   1      
 127   1        g_CurrentCount++;
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    250    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
